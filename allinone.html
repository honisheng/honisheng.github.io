<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>我們的婚禮邀請</title>
  <!-- Open Graph：方便分享時顯示預覽 -->
  <meta property="og:title" content="我們的婚禮邀請 – 張明聖＆黃惠如" />
  <meta property="og:description" content="邀請您見證我們的幸福時刻" />
  <meta property="og:image" content="images/share-img.png" />
  <style>
    /* 背景與淡入設定 */
    body {
      background-image: url('images/lin-palace-bg.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      opacity: 0;
      animation: fadeIn 2s ease-in-out forwards;
      position: relative;
      z-index: 0;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(255,255,255,0.7);
      z-index: -1;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }

    /* Intro overlay */
    #intro-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeOut 2s ease 3s forwards;
    }
    .intro-text {
      font-size: 2.5em;
      font-weight: bold;
      color: #d88c9a;
    }
    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    /* 信封動畫 */
    .intro { display: flex; justify-content: center; align-items: center; height: 100vh; background: #ffeaea; transition: opacity 1s ease; }
    .envelope { position: relative; width: 90vw; max-width:600px;height: auto; aspect-ratio: 6/5 ; background: #d9534f; border-radius:5px; overflow:hidden; cursor:pointer; box-shadow:0 8px 15px rgba(0,0,0,0.2); }
    .flap { position:absolute; top:0; left:0; width:100%; height:50%; background:#c9302c; transform-origin: top center; transition: transform 1s ease; z-index:2; }
    .letter { position:absolute; top:100%; left:0; width:100%; height:100%; background:#fff; padding:20px; box-sizing:border-box; transition:top 1s ease; z-index:1; font-size:14px; }
    .envelope.open .flap { transform: rotateX(-180deg); }
    .envelope.open .letter { top:0; }

    /* 主內容容器 */
    #main { display:none; opacity:0; }

    /* 主區塊 */
    .t1 { display:grid; grid-template-areas:"A B C"; grid-template-columns:1fr 3fr 1fr; gap:10px; }
    .section { margin-bottom:30px; padding-left:20px; }
    .title { color:#8B0000; font-weight:bold; font-size:1.2em; }
    .content { margin-top:5px; }
    .note { color:#D2691E; font-size:0.95em; margin-top:10px; }

    /* 愛心飄落效果 */
    #hearts { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999; }
    .heart { position:absolute; width:20px; height:20px; background:url('images/red-heart.svg') no-repeat center; background-size:contain; animation: fall 5s linear infinite; }
    @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity:0; } }

    /* 表單與按鈕 */
    .toggle-button { background-color:#6666cc; color:white; padding:12px 16px; border:none; border-radius:8px; cursor:pointer; display:block; margin:30px auto 10px; font-size:18px; }
    .toggle-content { display:none; background:#fff; padding:20px; margin:0 auto 40px; width:90%; max-width:600px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    form label, form select, form input, form textarea, form button { display:block; width:100%; margin-bottom:15px; font-size:16px; }
    form button { background-color:#d81b60; color:white; padding:10px; border:none; border-radius:6px; cursor:pointer; }
    form button:hover { background-color:#c2185b; }

    /* 標題與地圖容器 */
    header, section, footer { padding:20px; max-width:800px; margin:auto; text-align:center; }
    .map-container { position:relative; width:100%; height:400px; border-radius:8px; overflow:hidden; margin-top:10px; }

  </style>
</head>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<body>

  <!-- Intro overlay -->
  <div id="intro-overlay"><div class="intro-text">我們結婚啦</div></div>

  <!-- 信封區 -->
  <div class="intro" id="intro">
    <div class="envelope" id="envelope">
      <div class="flap">
        <h1 style="text-align:center;color:white;margin-top:20px;font-size:80px;">囍</h1>
        <h1 style="text-align:center;color:white;">張明聖&黃惠如</h1>
        <p style="font-family:'Great Vibes',cursive;font-size:60px;color:white;text-align:right;margin-right:30px;">I ❤ You</p>
      </div>
      <div class="letter">
        <h2>婚宴邀請函</h2><br><h1>我們誠摯地邀請您參加我們的婚禮</h1><h1>一起見證這美好的時刻。</h1>
      </div>
    </div>
  </div>

  <!-- 主內容 -->
  <div id="main">
    <header><h1>張明聖&黃惠如誠摯地邀請您參加</h1></header>

    <!-- BGM -->
    <audio id="bgm" src="music/wedding-music.mp3" loop></audio>

    <!-- 愛心特效 -->
    <div id="hearts"></div>

    <!-- 資訊區 -->
    <div class="t1">
      <div class="A"></div>
      <div class="B">
        <div class="section"><div class="title">日期 Date</div><div class="content">2023/11/01 (六) 晚宴</div></div>
        <div class="section"><div class="title">時間 Time</div><div class="content">16:30 戶外證婚 → 17:00 迎賓酒會 → 17:30 敬邀入席 → 18:00 準時開席</div></div>
        <div class="section"><div class="title">地點 Location</div><div class="content">台中林皇宮宮廷館 1F 白珍珠廳（台中市西屯區臺灣大道三段33號）</div></div>

        <!-- 回函表單 -->
        <section>
          <button class="toggle-button" onclick="toggleSection('rsvp-content')">📩 婚宴回函</button>
          <div id="rsvp-content" class="toggle-content">
            <form id="rsvp-form">
              <label for="name">您的姓名：</label><input type="text" id="name" name="name" required />
              <label>您與新人的關係</label>
              <select name="relation"><option value="">請選擇</option><option value="A">男方親戚</option><option value="B">女方親戚</option><option value="C">男方朋友</option><option value="D">女方朋友</option><option value="E">男方同事</option><option value="F">女方同事</option></select>
              <label>您會來參與我們的婚宴嗎？</label>
              <select name="attendance" id="attendance" required><option value="">請選擇</option><option value="yes">非常樂意</option><option value="no">無法參加</option></select>
              <div id="guest-count-group" style="display:none;">
                <label for="guest-count">出席人數：</label>
                <select id="guest-count" name="guest-count"><option value="">請選擇人數</option></select>
              </div>
              <label>需要為您準備素食嗎？</label>
              <select name="vegetarian" id="vegetarian" required><option value="">請選擇</option><option value="yes">是的，我需要</option><option value="no">謝謝，不需要</option></select>
              <div id="guest-v-group" style="display:none;">
                <label for="guest-v">人數：</label>
                <select id="guest-v" name="guest-v"></select>
              </div>
              <button type="submit">送出回覆</button>
            </form>
          </div>
        </section>

        <!-- 地圖 -->
        <section>
          <button class="toggle-button" onclick="toggleSection('map-content')">🗺️ 婚宴地圖</button>
          <div id="map-content" class="toggle-content">
            <div class="map-container">
              <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d14561.036401887412!2d120.64254316053778!3d24.16264433788154!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x34693d8c2f21172f%3A0xc5fa8741cb3c07d7!2z5Y-w5Lit5p6X55qH5a6u!5e0!3m2!1szh-TW!2stw!4v1746501511946!5m2!1szh-TW!2stw" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
          </div>
        </section>

        <div class="note">
          建議搭乘高鐵於烏日站搭高鐵接駁車，在110市政路口下車，需注意林皇宮是2棟間由玻璃帷幕柱中間一段白布條入口進場，車多、停車位有限，建議共乘！
        </div>
      </div>
      <div class="C"></div>
    </div>

    <footer><p>© 2025 張&黃 敬邀</p></footer>
  </div>

  <script>
  //firebaseConfig
  const firebaseConfig = {
    apiKey: "AIzaSyCRKeXJg7ZFyoy2N3RoVgMFnaaHQ1y5WWE",
    authDomain: "wedding-3e426.firebaseapp.com",
    projectId: "wedding-3e426",
    storageBucket: "wedding-3e426.firebasestorage.app",
    messagingSenderId: "531046039955",
    appId: "1:531046039955:web:ac629474956529c160e866"
  };

  // 初始化 Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  
    // Toggle 折疊區塊
    function toggleSection(id) {
      const el = document.getElementById(id);
      el.style.display = (el.style.display === "none" || el.style.display === "") ? "block" : "none";
    }
	
	function populateOptions(id) {
  const select = document.getElementById(id);
  for (let i = 1; i <= 10; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = `${i} 位`;
    select.appendChild(option);
  }
}
populateOptions("guest-count");
populateOptions("guest-v");

    document.addEventListener('DOMContentLoaded', () => {
      const attendance = document.getElementById('attendance');
      const guestCountGroup = document.getElementById('guest-count-group');
      attendance.addEventListener('change', () => guestCountGroup.style.display = attendance.value === "yes" ? "block" : "none");

      const vegetarian = document.getElementById('vegetarian');
      const guestVGroup = document.getElementById('guest-v-group');
      vegetarian.addEventListener('change', () => guestVGroup.style.display = vegetarian.value === "yes" ? "block" : "none");

// ⭐️ 表單提交事件
      document.getElementById('rsvp-form').addEventListener('submit', function(e) {
        e.preventDefault();
		const name = document.getElementById('name').value;
      const relation = this.relation.value;
      const attendance = this.attendance.value;
      const guestCount = document.getElementById('guest-count').value || "0";
      const vegetarian = this.vegetarian.value;
      const guestV = document.getElementById('guest-v').value || "0";

      db.collection("rsvps").add({
        name,
        relation,
        attendance,
        guestCount,
        vegetarian,
        guestV,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        alert('感謝您的回覆！我們期待與您共度美好時光。');
        this.reset();
        guestCountGroup.style.display = 'none';
        guestVGroup.style.display = 'none';
		}).catch((error) => {
        alert("發生錯誤，請稍後再試！");
        console.error("Firestore 錯誤：", error);
		if (attendance === "yes" && guestCount === "0") {
  alert("請選擇出席人數");
  return;
}
      });
	  // 預設展開 回函表單 與 地圖區塊
  document.getElementById('rsvp-content').style.display = 'block';
  document.getElementById('map-content').style.display = 'block';
    });

    // 愛心特效
    function createHeart() {
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.style.left = Math.random() * 100 + "vw";
      heart.style.animationDuration = 3 + Math.random() * 2 + "s";
      document.getElementById("hearts").appendChild(heart);
      setTimeout(() => heart.remove(), 5000);
    }
    setInterval(createHeart, 300);

    // 信封動畫與音樂觸發
    const envelope = document.getElementById('envelope');
    const intro = document.getElementById('intro');
    const main = document.getElementById('main');
    const bgm = document.getElementById('bgm');
    envelope.addEventListener('click', () => {
      envelope.classList.add('open');
      setTimeout(() => {
        intro.style.opacity = 0;
        setTimeout(() => {
          intro.style.display = 'none';
          main.style.display = 'block';
          main.style.animation = 'fadeIn 1.5s ease forwards';
          // 啟動音樂
          bgm.volume = 0.2;
          bgm.muted = false;
          bgm.play().catch(e => console.warn("音樂播放失敗", e));
        }, 1000);
      }, 1500);
    });
	});
	;
  </script>

</body>
</html>
