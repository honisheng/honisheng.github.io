<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘å€‘çš„å©šç¦®é‚€è«‹</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- Open Graphï¼šæ–¹ä¾¿åˆ†äº«æ™‚é¡¯ç¤ºé è¦½ -->
  <meta property="og:title" content="æˆ‘å€‘çš„å©šç¦®é‚€è«‹ â€“ å¼µæ˜è–ï¼†é»ƒæƒ å¦‚" />
  <meta property="og:description" content="é‚€è«‹æ‚¨è¦‹è­‰æˆ‘å€‘çš„å¹¸ç¦æ™‚åˆ»" />
  <meta property="og:image" content="images/share-img.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
  <link rel="manifest" href="images/site.webmanifest">


<style>
        /* èƒŒæ™¯èˆ‡æ·¡å…¥è¨­å®š */
    body {
      background-image: url('images/lin-palace-bg.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      opacity: 0;
      animation: fadeIn 2s ease-in-out forwards;
      position: relative;
      z-index: 0;
    }
    body::before {
      content: "";
      position: fixed;
      top: 0; 
	  left: 0; 
	  right: 0; 
	  bottom: 0;
      background-color: rgba(255,255,255,0.7);
      z-index: -1;
    }
    @keyframes fadeIn {
      to { opacity: 1; }
    }

    /* Intro overlay */
    #intro-overlay {
      position: fixed;
      top: 0; 
	  left: 0; 
	  width: 100%; 
	  height: 100%;
      background-color: white;
	  background-image: url('images/0001.jpg');
			 background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      animation: fadeOut 2s ease 3s forwards;
    }
    .intro-text {
      font-size: 3.5em;
      font-weight: bold;
      color: #d88c9a;
	  transform: translateY(-200px);
    }
	
	
	
    @keyframes fadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    /* ä¿¡å°å‹•ç•« */
    .intro { display: flex; 
			 justify-content: center; 
			 align-items: center; 
			 height: 100vh; 
			 background: #ffeaea; 
			 
			 transition: opacity 1s ease; }
    .envelope { position: relative; 
				width: 90vw; 
				max-width:600px;
				height: auto; 
				aspect-ratio: 6/5 ; 
				background: #d9534f; 
				border-radius:5px; 
				overflow:hidden; 
				cursor:pointer; 
				box-shadow:0 8px 15px rgba(0,0,0,0.2); }
    .flap { position:absolute; 
			top:0; 
			left:0; 
			width:100%; 
			height:50%; 
			background:#c9302c; 
			transform-origin: top center; 
			transition: transform 1s ease; 
			z-index:2; }
    .letter { position:absolute; 
			  top:100%; 
			  left:0; 
			  width:100%; 
			  height:100%; 
			  background:#fff; 
			  padding:20px; 
			  box-sizing:border-box; 
			  transition:top 1s ease; 
			  z-index:1; 
			  font-size:14px; }
    .envelope.open .flap { transform: rotateX(-180deg); }
    .envelope.open .letter { top:0; }

    /* ä¸»å…§å®¹å®¹å™¨ */
    #main { display:none; opacity:0; }

    /* ä¸»å€å¡Š */
    .t1 { display:grid; 
		  grid-template-areas:"A B C"; 
		  grid-template-columns:1fr 3fr 1fr; gap:10px; }
    .section { margin-bottom:30px; 
			   padding-left:20px; 
text-align: center;}
    .title { color:#8B0000; 
			 font-weight:bold; 
			 font-size:1.2em;
text-align: center; 
font-size: 30px;
}
    .content { margin-top:5px; text-align: center;
}
    .note { color:#D2691E; 
			font-size:2em; 
			margin-top:5px; }

    
    @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity:0; } }

    /* è¡¨å–®èˆ‡æŒ‰éˆ• */
    .toggle-button { background-color:#6666cc; 
					 color:white; 
					 padding:12px 16px; 
					 border:none; 
					 border-radius:8px; 
					 cursor:pointer; 
					 display:block; 
					 margin:30px auto 10px; 
					 font-size:18px; }
    .toggle-content { display:none; 
					  background:#fff; 
					  padding:20px; 
					  margin:0 auto 40px; 
					  width:90%; 
					  max-width:600px; 
					  border-radius:10px; 
					  box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    form label, form select, form input, form textarea, form button { 
		display:block; 
		width:100%; 
		margin-bottom:15px; 
		font-size:16px; }
    form button { background-color:#d81b60; 
		color:white; 
		padding:10px; 
		border:none; 
		border-radius:6px; 
		cursor:pointer; }
    form button:hover { background-color:#c2185b; }

    /* æ¨™é¡Œèˆ‡åœ°åœ–å®¹å™¨ */
    header, section, footer { padding:20px; 
							  max-width:800px; 
							  margin:auto; 
							  text-align:center; }
    .map-container { position:relative; 
					 width:100%; 
					 height:400px; 
					 border-radius:8px; 
					 overflow:hidden; 
					 margin-top:10px; }

  
/* RWD éŸ¿æ‡‰å¼è¨­è¨ˆ */
@media (max-width: 768px) {
  .t1 {
    grid-template-areas: "B";
    grid-template-columns: 1fr;
  }
  .A, .C {
    display: none;
  }

  .section {
    padding-left: 0;
  }

  .note {
    font-size: 0.85em;
    padding: 0 10px;
  }

  .map-container {
    height: 300px;
  }
}

@media (max-width: 480px) {
  .flap h1 {
    font-size: 50px !important;
  }

  .flap p {
    font-size: 40px !important;
  }

  .letter {
    font-size: 13px;
    padding: 15px;
  }

  form label, form select, form input, form textarea, form button {
    font-size: 14px;
  }

  .map-container {
    height: 250px;
  }
}

@keyframes shake {
  0%, 100% { transform: translateX(-50%); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(calc(-50% - 5px)); }
  20%, 40%, 60%, 80% { transform: translateX(calc(-50% + 5px)); }
}

.error-shake {
  animation: shake 0.5s ease-in-out;
}
</style>

</head>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<body>

  <!-- Intro overlay -->
  <div id="intro-overlay"><div class="intro-text">æˆ‘å€‘çµå©šå•¦</div></div>

  <!-- ä¿¡å°å€ -->
  <div class="intro" id="intro">
    <div class="envelope" id="envelope">
      <div class="flap">
        <h1 style="text-align:center;color:white;margin-top:20px;font-size:80px;">å›</h1>
        <h1 style="text-align:center;color:white;">å¼µæ˜è–&é»ƒæƒ å¦‚</h1>
        <p style="font-family:'Great Vibes',cursive;font-size:60px;color:white;text-align:right;margin-right:30px;">I â¤ You</p>
      </div>
      <div class="letter">
        <h2>å©šå®´é‚€è«‹å‡½</h2><br><h1>æˆ‘å€‘èª æ‘¯åœ°é‚€è«‹æ‚¨åƒåŠ æˆ‘å€‘çš„å©šç¦®</h1><h1>ä¸€èµ·è¦‹è­‰é€™ç¾å¥½çš„æ™‚åˆ»ã€‚</h1>
      </div>
    </div>
  </div>

  <!-- ä¸»å…§å®¹ -->
  <div id="main">
    <header>
	<h1>å¼µæ˜è–&é»ƒæƒ å¦‚</h1>
	<h2>èª æ‘¯åœ°é‚€è«‹æ‚¨åƒåŠ </h2>
	</header>

    <!-- è³‡è¨Šå€ -->
    <div class="t1">
      <div class="A"></div>
      <div class="B">
        <div class="section"><div class="title">æ—¥æœŸ Date</div><div class="content">2025/11/01 (å…­) æ™šå®´</div></div>
        <div class="section"><div class="title">æ™‚é–“ Time</div><div class="content">16:30 æˆ¶å¤–è­‰å©š â†’ 17:00 è¿è³“é…’æœƒ â†’ 17:30 æ•¬é‚€å…¥å¸­ â†’ 18:00 æº–æ™‚é–‹å¸­</div></div>
        <div class="section"><div class="title">åœ°é» Location</div><div class="content">å°ä¸­æ—çš‡å®®å®®å»·é¤¨ 1F ç™½çç å»³ï¼ˆå°ä¸­å¸‚è¥¿å±¯å€è‡ºç£å¤§é“ä¸‰æ®µ33è™Ÿï¼‰</div></div>

        <!-- å›å‡½è¡¨å–® -->
        <section>
          <h2>ğŸ“© å©šå®´å›å‡½</h2>
			<div id="rsvp-content" class="toggle-content" style="display:block;">			
			<form id="rsvp-form" >
			<!-- åŸºæœ¬æ¬„ä½ï¼ˆå§‹çµ‚é¡¯ç¤ºï¼‰ -->
              <label for="name">æ‚¨çš„å§“åï¼š</label>
			  <input type="text" id="name" name="name" required />
			  
              <label>æ‚¨èˆ‡æ–°äººçš„é—œä¿‚</label>
              <select id="relation" name="relation" required>
			  <option value="">è«‹é¸æ“‡</option>
			  <option value="A">ç”·æ–¹è¦ªæˆš</option>
			  <option value="B">å¥³æ–¹è¦ªæˆš</option>
			  <option value="C">ç”·æ–¹æœ‹å‹</option>
			  <option value="D">å¥³æ–¹æœ‹å‹</option>
			  <option value="E">ç”·æ–¹åŒäº‹</option>
			  <option value="F">å¥³æ–¹åŒäº‹</option>
			  </select>
			  
              <label>æ‚¨æœƒä¾†åƒèˆ‡æˆ‘å€‘çš„å©šå®´å—ï¼Ÿ</label>
              <select name="attendance" id="attendance" required>
			  <option value="">è«‹é¸æ“‡</option>
			  <option value="yes">éå¸¸æ¨‚æ„</option>
			  <option value="no">ç„¡æ³•åƒåŠ ï¼Œç´…åŒ…ä¸€å®šåˆ°</option>
			  </select>
			  
			  <!-- å‡ºå¸­ç›¸é—œæ¬„ä½ï¼ˆåƒ…ç•¶é¸æ“‡"éå¸¸æ¨‚æ„"æ™‚é¡¯ç¤ºï¼‰ -->
              <div id="guest-count-group" style="display:none;">
                <label for="guest-count">å‡ºå¸­äººæ•¸ï¼š</label>
                <select id="guest-count" name="guest-count">
				  <option value="">è«‹é¸æ“‡äººæ•¸</option>
				</select>
              </div>
			  
              <div id="vegetarian-group" style="display:none;">
				<label>éœ€è¦ç‚ºæ‚¨æº–å‚™ç´ é£Ÿå—ï¼Ÿ</label>
				<select name="vegetarian" id="vegetarian">
					<option value="">è«‹é¸æ“‡</option>
					<option value="yes">æ˜¯çš„ï¼Œæˆ‘éœ€è¦</option>
					<option value="no">è¬è¬ï¼Œä¸éœ€è¦</option>
				</select>
			  </div>
  
			  <div id="guest-v-group" style="display:none;">
				<label for="guest-v">ç´ é£Ÿäººæ•¸ï¼š</label>
				<select id="guest-v" name="guest-v"></select>
			  </div>
			  
			  <div id="ceremony-group" style="display:none;">
				<label>æ‚¨é¡˜æ„åƒåŠ æˆ‘å€‘åœ¨16:30èˆ‰è¾¦çš„æˆ¶å¤–è­‰å©šå„€å¼å—ï¼Ÿ</label>
				<select name="ceremony" id="ceremony">
					<option value="">è«‹é¸æ“‡</option>
					<option value="yes">é¡˜æ„åƒåŠ è­‰å©šå„€å¼</option>
					<option value="no">æ²’é—œä¿‚ï¼Œæˆ‘æœƒåƒåŠ å©šå®´</option>
				</select>
			  </div>
			  
			  <div id="baby-seat-group" style="display:none;">
				<label>æ˜¯å¦éœ€è¦å¬°å…’åº§æ¤…ï¼Ÿ</label>
				<label><input type="radio" name="needBabySeat" value="æ˜¯" onclick="toggleBabySeatCount(true)" /> æ˜¯</label>
				<label><input type="radio" name="needBabySeat" value="å¦" onclick="toggleBabySeatCount(false)" /> å¦</label>
    
				<div id="babySeatCountContainer" style="display: none;">
				<label for="babySeatCount">éœ€è¦å¹¾å¼µå¬°å…’åº§æ¤…ï¼Ÿ</label>
				<input type="number" id="babySeatCount" name="babySeatCount" min="1" max="10" />
				</div>
			  </div>

				
              <button type="submit">é€å‡ºå›è¦†</button>
			  <!-- åœ¨è¡¨å–®æŒ‰éˆ•æ—æ·»åŠ  -->
<div id="submit-loader" style="display:none; margin-top:10px;">
    <div style="border:3px solid #f3f3f3; border-top:3px solid #d81b60; border-radius:50%; width:20px; height:20px; animation:spin 1s linear infinite; margin:0 auto;"></div>
  </div>
			  
            </form>
          </div>
        </section>
		<div id="thankYouMessage" style="display:none; text-align:center; margin-top:2rem;">
		<h1>ğŸ’Œ å›å‡½å·²æ”¶åˆ°ï¼Œæ„Ÿè¬æ‚¨çš„ç¥ç¦ï¼</h1>
		<p>æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„å›è¦†ï¼ŒæœŸå¾…åœ¨å©šç¦®ç¾å ´èˆ‡æ‚¨ç›¸è¦‹ï¼</p>
	  </div>
<div id="formError" style="display:none; 
     position: fixed; 
     top: 20px; 
     left: 50%; 
     transform: translateX(-50%); 
     z-index: 10000;
     max-width: 90%;
     width: 400px;
     box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
        <!-- åœ°åœ– -->
        <section>
          <h2>ğŸ—ºï¸ å©šå®´åœ°åœ–</h2>
			<div id="map-content" class="toggle-content" style="display:block;">
            <div class="map-container">
              <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d14561.036401887412!2d120.64254316053778!3d24.16264433788154!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x34693d8c2f21172f%3A0xc5fa8741cb3c07d7!2z5Y-w5Lit5p6X55qH5a6u!5e0!3m2!1szh-TW!2stw!4v1746501511946!5m2!1szh-TW!2stw" width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
            </div>
          </div>
        </section>

        <div class="note">
          æ—çš‡å®®æœ‰åœ°ä¸‹åœè»Šå ´ã€åœè»Šä½æœ‰é™ï¼Œå»ºè­°å…±ä¹˜ï¼<br>
		  è‹¥æ»¿ä½ï¼Œå…©æ—æ–‡å¿ƒè·¯äºŒæ®µåŠæƒ ä¸­è·¯ä¸€æ®µæœ‰å¸‚æ”¿å…¬åœ’ã€å¸‚æ”¿åºœå¹³é¢åœè»Šå ´~~
        </div>
      </div>
	  
	  
      <div class="C"></div>
    </div>

    <footer><p>Â© 2025 å¼µ&é»ƒ æ•¬é‚€</p></footer>
  </div>

  <script>
    //firebaseConfig
  const firebaseConfig = {
    apiKey: "AIzaSyCRKeXJg7ZFyoy2N3RoVgMFnaaHQ1y5WWE",
    authDomain: "wedding-3e426.firebaseapp.com",
    projectId: "wedding-3e426",
    storageBucket: "wedding-3e426.firebasestorage.app",
    messagingSenderId: "531046039955",
    appId: "1:531046039955:web:ac629474956529c160e866"
  };

  // åˆå§‹åŒ– Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function populateOptions(id) {
    const select = document.getElementById(id);
    const defaultOption = document.createElement('option');
    defaultOption.value = "";
    defaultOption.textContent = "è«‹é¸æ“‡";
    select.appendChild(defaultOption);
    for (let i = 1; i <= 10; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = `${i} ä½`;
      select.appendChild(option);
    }
  }

function showError(message) {
  const errorEl = document.getElementById("formError");
  errorEl.innerHTML = `<div style="padding: 15px; border-radius: 8px; background: #fff5f5; border: 2px solid #ff4444; text-align: center;">
    <span style="font-size: 24px;">â—</span>
    <div style="margin-top: 8px; font-weight: bold;">${message}</div>
  </div>`;
  
  errorEl.style.display = "block";
  errorEl.classList.add("error-shake");
  
  setTimeout(() => {
    errorEl.classList.remove("error-shake");
  }, 500);
  
  setTimeout(() => {
    errorEl.style.display = "none";
  }, 5000);
}
  populateOptions("guest-count");
  populateOptions("guest-v");

  //æ§åˆ¶å¬°å…’åº§æ¤…å¼µæ•¸æ¬„ä½é¡¯ç¤º
  function toggleBabySeatCount(show) {
    const container = document.getElementById("babySeatCountContainer");
    container.style.display = show ? "block" : "none";
  }

function updateVegetarianOptions() {
  const guestCount = parseInt(document.getElementById('guest-count').value) || 0;
  const guestVSelect = document.getElementById('guest-v');
  
  // æ¸…ç©ºç¾æœ‰é¸é …
  guestVSelect.innerHTML = '';
  
  // æ·»åŠ é è¨­é¸é …
  const defaultOption = document.createElement('option');
  defaultOption.value = "";
  defaultOption.textContent = "è«‹é¸æ“‡";
  guestVSelect.appendChild(defaultOption);
  
  // åªç”Ÿæˆä¸è¶…éç¸½äººæ•¸çš„é¸é …
  for (let i = 1; i <= guestCount; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = `${i} ä½`;
    guestVSelect.appendChild(option);
  }
}

// åœ¨å‡ºå¸­äººæ•¸è®Šæ›´æ™‚æ›´æ–°ç´ é£Ÿé¸é …
document.getElementById('guest-count').addEventListener('change', updateVegetarianOptions);

  // --- ä¸»è¦æ”¹å‹•å€ ---
document.addEventListener('DOMContentLoaded', () => {
    const ceremonyGroup = document.getElementById('ceremony-group');
    const attendance = document.getElementById('attendance');
    const guestCountGroup = document.getElementById('guest-count-group');
    const vegetarianGroup = document.getElementById('vegetarian').parentElement;
    const guestVGroup = document.getElementById('guest-v-group');
    const vegetarian = document.getElementById('vegetarian');
    const babySeatRadios = document.querySelectorAll('input[name="needBabySeat"]');
    const babySeatContainer = document.getElementById('babySeatCountContainer');
    // å–å¾—radioå¤–å±¤div
    const babySeatRadioGroup = babySeatRadios[0].closest('div');

    function updateFormByAttendance() {
  if (attendance.value === "yes") {
    // é¡¯ç¤ºæ‰€æœ‰ç›¸é—œæ¬„ä½
    guestCountGroup.style.display = "block";
    vegetarianGroup.style.display = "block";
    guestVGroup.style.display = vegetarian.value === "yes" ? "block" : "none";
    babySeatRadioGroup.style.display = "block";
    ceremonyGroup.style.display = "block";
    babySeatContainer.style.display = document.querySelector('input[name="needBabySeat"]:checked')?.value === "æ˜¯" ? "block" : "none";
    
    // è¨­ç½®å¿…å¡«
    document.getElementById('guest-count').setAttribute('required', 'required');
    document.getElementById('vegetarian').setAttribute('required', 'required');
    document.getElementById('ceremony').setAttribute('required', 'required');
    babySeatRadios.forEach(r => r.required = true);
    
  } else if (attendance.value === "no") {
    // åªéš±è—èˆ‡å‡ºå¸­ç›¸é—œçš„ç´°ç¯€æ¬„ä½ï¼Œä¿ç•™åŸºæœ¬æ¬„ä½
    guestCountGroup.style.display = "none";
    vegetarianGroup.style.display = "none";
    guestVGroup.style.display = "none";
    babySeatRadioGroup.style.display = "none";
    ceremonyGroup.style.display = "none";
    babySeatContainer.style.display = "none";
    
    // ç§»é™¤å¿…å¡«ä¸¦æ¸…ç©ºå€¼
    document.getElementById('guest-count').removeAttribute('required');
    document.getElementById('guest-count').value = "";
    document.getElementById('vegetarian').removeAttribute('required');
    document.getElementById('vegetarian').value = "";
    document.getElementById('guest-v').value = "";
    document.getElementById('ceremony').removeAttribute('required');
    document.getElementById('ceremony').value = "";
    babySeatRadios.forEach(r => {
      r.checked = false;
      r.required = false;
    });
    document.getElementById('babySeatCount').value = "";
  }
}

    attendance.addEventListener('change', updateFormByAttendance);

    vegetarian.addEventListener('change', () => {
      guestVGroup.style.display = vegetarian.value === "yes" && attendance.value === "yes" ? "block" : "none";
    });

    babySeatRadios.forEach(radio => {
      radio.addEventListener('change', function () {
        if (attendance.value === "yes") {
          toggleBabySeatCount(this.value === "æ˜¯");
        }
        if (this.value !== "æ˜¯") {
          document.getElementById('babySeatCount').value = "";
        }
      });
    });

    // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
    updateFormByAttendance();
	
// å…¨å±€è®Šé‡ï¼Œæ¨™è¨˜æ˜¯å¦æ­£åœ¨æäº¤ä¸­
let isSubmitting = false; 

    // è¡¨å–®æäº¤äº‹ä»¶
    document.getElementById('rsvp-form').addEventListener('submit', function (e) {
      e.preventDefault();
	  document.getElementById('submit-loader').style.display = 'block';
	    
		// é˜²é‡è¤‡æª¢æŸ¥
	  if (isSubmitting) {
  showError("ç³»çµ±æ­£åœ¨è™•ç†æ‚¨çš„å›è¦†ï¼Œè«‹å‹¿é‡è¤‡é»æ“Šï¼");
  document.getElementById('submit-loader').style.display = 'none';
  return;
}
if (sessionStorage.getItem('formSubmitted') === 'true') {
  showError("<span style='font-size:1.2em'>æ‚¨å·²ç¶“æˆåŠŸæäº¤éå›è¦†ï¼</span><br>è«‹å‹¿é‡è¤‡æäº¤ï¼Œæˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„å›å‡½");
  document.getElementById('submit-loader').style.display = 'none';
  return;
}
  isSubmitting = true;
  sessionStorage.setItem('formSubmitted', 'true');
  const form = this;
  const submitBtn = form.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.innerText = "å·²é€å‡ºâ€¦";
	  
	  
      const name = document.getElementById('name').value;
      const relation = this.relation.value;
      const attendance = this.attendance.value;
	  const ceremony = attendance === "yes" ? this.ceremony.value : "not_attending";
	  const guestCount = attendance === "yes" ? (document.getElementById('guest-count').value || "0") : "0";
      const vegetarian = attendance === "yes" ? this.vegetarian.value : "no";
      const guestV = attendance === "yes" ? (document.getElementById('guest-v').value || "0") : "0";
      const needBabySeat = attendance === "yes" ? form.needBabySeat.value : "å¦";
  const babySeatCount = attendance === "yes" ? (form.babySeatCount.value || null) : null;
      
	  
	  
	  // é˜²é‡è¤‡æª¢æŸ¥
  
  
      
	  
      if (attendance === "yes" && vegetarian === "yes") {
    const totalGuests = parseInt(guestCount);
    const vegGuests = parseInt(guestV);
    
    if (vegGuests > totalGuests) {
      showError("ç´ é£Ÿäººæ•¸ä¸èƒ½è¶…éç¸½å‡ºå¸­äººæ•¸");
      submitBtn.disabled = false;
      submitBtn.innerText = "é€å‡ºå›è¦†";
      return;
    }
  }

  // æ–°å¢é©—è­‰3: å¬°å…’åº§æ¤…æ•¸é‡ä¸èƒ½è¶…éç¸½äººæ•¸
  if (attendance === "yes" && needBabySeat === "æ˜¯" && babySeatCount > parseInt(guestCount)) {
    showError("å¬°å…’åº§æ¤…æ•¸é‡ä¸èƒ½è¶…éç¸½å‡ºå¸­äººæ•¸");
    submitBtn.disabled = false;
    submitBtn.innerText = "é€å‡ºå›è¦†";
    return;
  }

  // æ‰€æœ‰é©—è­‰é€šéå¾Œæäº¤è¡¨å–®
	 
      db.collection("rsvps").add({
        name,
    relation,
    attendance,
    guestCount,
    vegetarian,
    ceremony,
    guestV,
    needBabySeat,
    babySeatCount,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).then(() => {
    isSubmitting = false;
    document.getElementById('rsvp-form').style.display = 'none';
    document.getElementById('thankYouMessage').style.display = 'block';
    document.getElementById('submit-loader').style.display = 'none';
  }).catch((error) => {
    isSubmitting = false;
    sessionStorage.removeItem('formSubmitted');
    document.getElementById('submit-loader').style.display = 'none';
    submitBtn.disabled = false;
    submitBtn.innerText = "é€å‡ºå›è¦†";
    alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ï¼");
    console.error("Firestore éŒ¯èª¤ï¼š", error);
        });
      //document.getElementById("babySeatCountContainer").style.display = 'none';
    });
	
	// æäº¤æ™‚


// å®Œæˆæˆ–å¤±æ•—æ™‚
document.getElementById('submit-loader').style.display = 'none';

    // ä¿¡å°å‹•ç•«èˆ‡éŸ³æ¨‚è§¸ç™¼
    const envelope = document.getElementById('envelope');
    const intro = document.getElementById('intro');
    const main = document.getElementById('main');
    
    let opened = false;
    envelope.addEventListener('click', () => {
      if (opened) return;
      opened = true;
      envelope.classList.add('open');
      setTimeout(() => {
        intro.style.opacity = 0;
        setTimeout(() => {
          intro.style.display = 'none';
          main.style.display = 'block';
          main.style.animation = 'fadeIn 1.5s ease forwards';
          { once: true };
        }, 1500);
      });
    });
  });


  </script>

</body>
</html>
